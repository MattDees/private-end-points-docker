#! /bin/bash

if [ $SAFE_PEP -eq 1 ]; then
   blocklist_url="https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts"
   dummy_ip="0.0.0.0"
   conf_file="/etc/unbound/hostfiles/adware-malware.conf"
   wget -qO- ${blocklist_url} | grep '^0\.0\.0\.0' | awk '{print "local-zone: \""$2"\" redirect\nlocal-data: \""$2" A '${dummy_ip}'\""}' > ${conf_file};
fi

modified_date=`stat -c %y /etc/unbound/hostfiles/adware-malware.conf | cut -d' ' -f1`
today_date=`date +%Y-%m-%d`

if [ $modified_date -eq $today_date ]; then
   kill -9 `cat /var/run/unbound/unbound.pid`
   unbound -d   
fi
